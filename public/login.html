<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body class="bg-light">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">GCETTS Synergy</a>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title text-center mb-4">OTP Verification</h4>

                        <!-- Mobile Number Field -->
                        <div class="mb-3">
                            <label for="mobileNumber" class="form-label">Mobile Number</label>
                            <input type="text" class="form-control" id="mobileNumber" placeholder="Enter mobile number"
                                required>
                            <small id="mobileError" class="form-text text-danger" style="display: none;"></small>
                            <small id="otpSentMessage" class="form-text text-success" style="display: none;">OTP sent
                                successfully. Please check your phone.</small>
                        </div>
                        <button type="button" class="btn btn-primary w-100" id="getOtpBtn">Get OTP</button>

                        <!-- OTP Field -->
                        <div class="mb-3 mt-4">
                            <label for="otp" class="form-label">OTP</label>
                            <input type="text" class="form-control" id="otp" placeholder="Enter OTP" maxlength="6"
                                required disabled>
                            <small id="otpError" class="form-text text-danger" style="display: none;"></small>
                        </div>
                        <button type="button" class="btn btn-success w-100" id="submitOtpBtn" disabled>Submit</button>
                        <small id="otpVerificationMessage" class="form-text text-danger" style="display: none;"></small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const mobileInput = document.getElementById('mobileNumber');
        const otpInput = document.getElementById('otp');
        const getOtpButton = document.getElementById('getOtpBtn');
        const submitOtpButton = document.getElementById('submitOtpBtn');
        const mobileError = document.getElementById('mobileError');
        const otpError = document.getElementById('otpError');
        const otpSentMessage = document.getElementById('otpSentMessage');
        const otpVerificationMessage = document.getElementById('otpVerificationMessage');

        // Function to validate mobile number
        function validateMobileNumber(mobile) {
            return mobile.length === 10 && !isNaN(mobile);
        }

        // Function to validate OTP
        function validateOtp(otp) {
            return otp.length === 6 && !isNaN(otp);
        }

        // Send OTP
        getOtpButton.addEventListener('click', async () => {
            const mobilenumber = mobileInput.value.trim();
            if (validateMobileNumber(mobilenumber)) {
                mobileError.style.display = 'none';
                try {
                    getOtpButton.disabled = true;
                    const response = await axios.post('/send-otp', { mobilenumber });
                    otpInput.disabled = false;
                    submitOtpButton.disabled = false;
                    otpSentMessage.style.display = 'block';
                    otpVerificationMessage.style.display = 'none';
                } catch (error) {
                    console.error("Error sending OTP:", error);
                    otpSentMessage.style.display = 'none';
                    otpVerificationMessage.textContent = "Error sending OTP. Please try again.";
                    otpVerificationMessage.style.display = 'block';
                } finally {
                    getOtpButton.disabled = false;
                }
            } else {
                mobileError.style.display = 'block';
                mobileError.textContent = "Please enter a valid 10-digit mobile number.";
            }
        });

        // Verify OTP
        submitOtpButton.addEventListener('click', async () => {
            const mobilenumber = mobileInput.value.trim();
            const otp = otpInput.value.trim();
            if (validateMobileNumber(mobilenumber) && validateOtp(otp)) {
                otpError.style.display = 'none';
                otpVerificationMessage.style.display = 'none';
                try {
                    submitOtpButton.disabled = true;
                    const response = await axios.post('/verify-otp', { mobilenumber, otp });
                    if (response.data.message === "Successful") {
                        window.location.href = '/';  // Redirect to home page
                    } else {
                        otpVerificationMessage.textContent = "Wrong OTP or mobile number. Please try again.";
                        otpVerificationMessage.style.display = 'block';
                    }
                } catch (error) {
                    console.error("Error verifying OTP:", error);
                    otpVerificationMessage.textContent = "Error verifying OTP. Please try again.";
                    otpVerificationMessage.style.display = 'block';
                } finally {
                    submitOtpButton.disabled = false;
                }
            } else {
                otpError.style.display = 'block';
                otpError.textContent = "Please enter a valid 6-digit OTP.";
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>